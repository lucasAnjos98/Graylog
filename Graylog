Procedimentos para a instalação do graylog

1. Faça a instalação do java
	
	$ sudo apt-get update && sudo apt-get upgrade
	$ sudo apt-get install apt-transport-https openjdk-8-jre-headless uuid-runtime pwgen

2. Faça a instalação do mongodb

	$ sudo apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv 9DA31620334BD75D9DCB49F368818C72E52529D4
	$ echo "deb [ arch=amd64 ] https://repo.mongodb.org/apt/ubuntu bionic/mongodb-org/4.0 multiverse" | sudo tee /etc/apt/sources.list.d/mongodb-org-4.0.list
	$ sudo apt-get update
	$ sudo apt-get install -y mongodb-org 10.233.48
	
3. Faça instalação do elasticsearch

	$ wget -q https://artifacts.elastic.co/GPG-KEY-elasticsearch -O myKey
	$ sudo apt-key add myKey
	$ echo "deb https://artifacts.elastic.co/packages/oss-7.x/apt stable main" | sudo tee -a /etc/apt/sources.list.d/elastic-7.x.list
	$ sudo apt-get update && sudo apt-get install elasticsearch-oss

4. Faça a instalação do graylog

	4.1 - Quando for instalar o graylog, instale a versão SEM os plugins enterprise e integration (pode dar erro com o mongodb depois)
	4.2 - Deve fazer a senha sha2: "pwgen -N 1 -s 96" - (copie e salve em um txt a senha gerada, irá precisar)
	4.3 - Deve fazer a senha de passe: "echo -n (sua senha) | sha256sum" - (copie e salve em um txt a senha gerada, irá precisar)
    4.4 - Deve alterar algumas coisas no arquivo de configuração do gray log: vim /etc/graylog/server/server.conf
		4.4.1 - Onde tiver escrito "root_password_sha2", coloque a senha gerada no passo 4.2
		4.4.2 - Onde tiver escrito "password_secret", coloque a senha gerada no passo 4.3
		4.4.3 - Logo embaixo de "#http_bind_address = [2001:db8::1]:9000", coloque:

			"root_timezone = America/Sao_Paulo"
			"rest_listen_uri = http://0.0.0.0:8080/api/"
			"web_listen_uri = http://0.0.0.0:9000/"

		4.4.4 - Descomente onde tiver escrito "http_bind_address = 127.0.0.1:9000" e mude para "http_bind_address = 0.0.0.0:9000"
		4.4.5 - Vá no browser e digite na aba de busca o ip da maquina e ":9000" - Ex: 192.168.0.87:9000
		4.4.6 - login = admim / senha = a que vc criou no passo 3.3.
		4.4.7 - Vá em system/inputs. Selecione a forma que vc receberá os logs (no meu caso - TCP), clique em "Lauch new input". 
            4.4.7.1 - Em "Node" - Selecione sua maquina. Em "title" coloque o nome dessa ligação. Em "port" coloque o numero da porta que irá receber os logs. Clique em Save.
		4.4.8 - Após esses passo o input deve esta em estado "RUNNING". Caso não esteja, algo no processo deu errado, verifique ou desintale e instale novamente o Graylog
		
5. Faça a instalação do rsyslog
    
    $ sudo apt install rsyslog
    
	5.1 - Faça alterações na configuração do rsyslog: vim /etc/rsyslog.d/50-default.conf (ubunto)
	5.2 - Abaixo de "First some standard log files. Log by facility", escreva: "Log      @@IP:Porta" 
        
        Ex: *.*        @@192.168.0.55:1514
        
        - *.*          - indica quais os logs que devem ser enviador (neste caso, todos os logs)
		- @@           - indica como quero envias (TCP = @@ ou UDP = @)
		- 192.168.0.55 - indica meu ip (deve colocar o ip que esta conectado ao graylog)
		- 1514         - indica a porta que o graylog esta trabalhando (deve ser a porta selecionada no passo 4.4.7.1)
        
        

6. Após esses passos vá no graylog aberto no seu browser e clique em "search" e dpois em no botão "play" ao lado de "Not updating"

7. Agora o graylog esta atualizando em tempo real o recebimento de logs gerados da maquina. Vá no servido e saia e entre em modo "root". Deve aparecer as informações no graylog.

    $ su - (precisará colocar a senha de root para a confirmação)
